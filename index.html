
<html>
<head>
  
  <title>HOME</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="chart.js"></script>
  <script src="calendar.js"></script>
 
  <link rel="Stylesheet" href="index_styles.css">
</head>
<body>
<div id="loading-screen">
  <div class="loader">
    <div></div><div></div><div></div>
    <div></div><div></div><div></div>
  </div>
</div>

<div class="back"></div>
<div class="over"></div>
<div class = "con">
  <h1>BReT</h1>
 <div class= "cflow">
	
	<a href="add.html">
	
	<div class="card">
	<h3>
	Report transaction </h3> <br>
	<p>
	Report the transactions that has <br>taken place for future use.</p>
	</div>
	</a>
	<div class="card" onclick="filterTransactions()">
	<h3>
	View Statement </h3> <br>
	<p>
	Visualize your monthly transactions <br> with organized statement.</p>
	</div>
	
 </div>
 <br>

<div class = "vis" id = "visible">
  <div class="summary" id="summary"></div>
  <div class="summary" id="savings"></div>
  
<div class= "cflow">
  <div class="chart-container">
    <h2>Receipts Classification</h2>
    <canvas id="incomeChart"></canvas>
  </div>

  <div class="chart-container">
    <h2>Payments Classification</h2>
    <canvas id="expenseChart"></canvas>
  </div>
  </div>
<hr>
  <div class="receipt">
    <h1>All Receipt Transactions</h1>
    <table id="receiptTable">
      <thead>
        <tr><th>Date</th><th>Amount</th><th>Category</th><th>Notes</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
  
<hr>
  <div class="payment">
    <h1>All Payment Transactions</h1>
    <table id="paymentTable">
      <thead>
        <tr><th>Date</th><th>Amount</th><th>Category</th><th>Notes</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
  </div>
  </div>
 
<script>
window.addEventListener("load", () => {
  const loader = document.getElementById("loading-screen");
  const content = document.querySelector(".content");

  
  loader.style.opacity = "0";
 

  

  setTimeout(() => {
    loader.style.display = "none";
    
  }, 4000); 
});

const setv = document.getElementById("visible");
const months = [
    "January", "February", "March", "April", "May", "June",
    "July", "August", "September", "October", "November", "December"
  ];

  const colors = [
    "rgb(128,0,0)", "rgb(0,128,0)", "rgb(0,0,140)", "rgb(128,125,0)",
    "rgb(128,0,128)", "rgb(0,125,128)", "rgb(153,153,255)",
    "rgb(255,130,128)", "rgb(255,255,255)", "rgb(51,51,153)",
    "rgb(66,154,124)"
  ];


  function filterTransactions() {
    selectMonthYear((m,y)=> {
	
	

    const dcode = parseInt(`${m+1}${y}`);
    const all = JSON.parse(localStorage.getItem("transactions") || "[]");
    const current = all.filter(t => t.acode === dcode);

    let receipts = [], payments = [];
    let incomeTotal = 0, expenseTotal = 0;
    let incomePie = {}, expensePie = {};

    current.forEach(t => {
      if (t.atype) {
        receipts.push(t);
        incomeTotal += t.amount;
        incomePie[t.acat] = (incomePie[t.acat] || 0) + t.amount;
      } else {
        payments.push(t);
        expenseTotal += t.amount;
        expensePie[t.acat] = (expensePie[t.acat] || 0) + t.amount;
      }
    });

    document.getElementById("summary").innerText =
      `Total Revenue: ₹${incomeTotal}, Total Expense: ₹${expenseTotal}`;

    const diff = incomeTotal - expenseTotal;
    document.getElementById("savings").innerText = 
      diff >= 0
        ? `Profit: ₹${diff}`
        : `Loss: ₹${Math.abs(diff)}`;
    document.getElementById("savings").style.color = diff >= 0 ? "green" : "red";
	setv.style.display = 'block';

    renderTable("receiptTable", receipts);
    renderTable("paymentTable", payments);
    renderPieChart("incomeChart", incomePie, "Income");
    renderPieChart("expenseChart", expensePie, "Expense");
	});
  }

  function renderTable(id, items) {
    const tbody = document.getElementById(id).querySelector("tbody");
    tbody.innerHTML = "";
    items.forEach(t => {
      const tr = document.createElement("tr");
      ["adate", "amount", "acat", "anote"].forEach(k => {
        const td = document.createElement("td");
        td.textContent = t[k];
        tr.appendChild(td);
      });
      tbody.appendChild(tr);
    });
  }

  let incomeChart, expenseChart;
  function renderPieChart(canvasId, dataMap, label) {
  const ctx = document.getElementById(canvasId).getContext("2d");
  const labels = Object.keys(dataMap);
  const data = Object.values(dataMap);

  const config = {
    type: "pie",
    data: {
      labels: labels,
      datasets: [{
        label,
        data: data,
        backgroundColor: [
          "#00b894", "#0984e3", "#6c5ce7", "#d63031", "#fdcb6e",
          "#e17055", "#2d3436", "#fab1a0", "#55efc4", "#ffeaa7"
        ],
        borderColor: "#121212",
        borderWidth: 2
      }]
    },
    options: {
      responsive: true,
      animation: {
        animateScale: true,
        animateRotate: true
      },
      plugins: {
        legend: {
          position: 'bottom',
          labels: {
            color: "#e0e0e0",
            font: { size: 14 }
          }
        },
        tooltip: {
          backgroundColor: "#1f1f1f",
          titleColor: "#00ff9d",
          bodyColor: "#ffffff",
          borderColor: "#333",
          borderWidth: 1
        }
      }
    }
  };

  if (canvasId === "incomeChart") {
    if (incomeChart) incomeChart.destroy();
    incomeChart = new Chart(ctx, config);
  } else {
    if (expenseChart) expenseChart.destroy();
    expenseChart = new Chart(ctx, config);
  }
}

document.querySelectorAll('a[href^="#"], button').forEach(el => {
  el.addEventListener('click', e => {
    const targetId = el.getAttribute('href');
    if (targetId && targetId.startsWith("#")) {
      e.preventDefault();
      document.querySelector(targetId).scrollIntoView({ behavior: 'smooth' });
    }
  });
});


const faders = document.querySelectorAll('.summary, .chart-container, table, h2');

const appearOptions = { threshold: 0.1 };

const appearOnScroll = new IntersectionObserver((entries, observer) => {
  entries.forEach(entry => {
    if (!entry.isIntersecting) return;
    entry.target.classList.add('appear');
    observer.unobserve(entry.target);
  });
}, appearOptions);

faders.forEach(fader => {
  fader.classList.add('fade-start');
  appearOnScroll.observe(fader);
});
 
</script>


</body>
</html>
