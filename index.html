
<html>
<head>
  
  <title>HOME</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="chart.js"></script>
 
  <link rel="Stylesheet" href="index_styles.css">
</head>
<body>

  <h1>BRET</h1>
  
<center>
	<a href="add.html"><button>Add transaction</button></a><br>
	<hr>
	<br>
  <div class="filter">
    <select id="month">
      <option value="">Select Month</option>
    </select>
    <select id="year">
      <option value="">Select Year</option>
    </select>
    <button onclick="filterTransactions()">View</button>
  </div>
  </center>
<hr>
  <div class="summary" id="summary"></div>
  <div class="summary" id="savings"></div>

  <div class="chart-container">
    <h2>Receipts Classification</h2>
    <canvas id="incomeChart"></canvas>
  </div>

  <div class="chart-container">
    <h2>Payments Classification</h2>
    <canvas id="expenseChart"></canvas>
  </div>
<hr>
  <div class="receipt">
    <h2>All Receipt Transactions</h2>
    <table id="receiptTable">
      <thead>
        <tr><th>Date</th><th>Amount</th><th>Category</th><th>Notes</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
<hr>
  <div class="payment">
    <h2>All Payment Transactions</h2>
    <table id="paymentTable">
      <thead>
        <tr><th>Date</th><th>Amount</th><th>Category</th><th>Notes</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
<script>
const months = [
    "January", "February", "March", "April", "May", "June",
    "July", "August", "September", "October", "November", "December"
  ];

  const colors = [
    "rgb(128,0,0)", "rgb(0,128,0)", "rgb(0,0,140)", "rgb(128,125,0)",
    "rgb(128,0,128)", "rgb(0,125,128)", "rgb(153,153,255)",
    "rgb(255,130,128)", "rgb(255,255,255)", "rgb(51,51,153)",
    "rgb(66,154,124)"
  ];

  const currentYear = new Date().getFullYear();
  const monthSelect = document.getElementById("month");
  const yearSelect = document.getElementById("year");

  months.forEach((m, i) => {
    const opt = document.createElement("option");
    opt.value = i + 1;
    opt.text = m;
    monthSelect.add(opt);
  });

  for (let y = currentYear - 5; y <= currentYear + 5; y++) {
    const opt = document.createElement("option");
    opt.value = y;
    opt.text = y;
    yearSelect.add(opt);
  }

  function filterTransactions() {
    const m = parseInt(monthSelect.value);
    const y = parseInt(yearSelect.value);
    if (!m || !y) return alert("Select both month and year");

    const dcode = parseInt(`${m}${y}`);
    const all = JSON.parse(localStorage.getItem("transactions") || "[]");
    const current = all.filter(t => t.acode === dcode);

    let receipts = [], payments = [];
    let incomeTotal = 0, expenseTotal = 0;
    let incomePie = {}, expensePie = {};

    current.forEach(t => {
      if (t.atype) {
        receipts.push(t);
        incomeTotal += t.amount;
        incomePie[t.acat] = (incomePie[t.acat] || 0) + t.amount;
      } else {
        payments.push(t);
        expenseTotal += t.amount;
        expensePie[t.acat] = (expensePie[t.acat] || 0) + t.amount;
      }
    });

    document.getElementById("summary").innerText =
      `Total Revenue: ₹${incomeTotal}, Total Expense: ₹${expenseTotal}`;

    const diff = incomeTotal - expenseTotal;
    document.getElementById("savings").innerText = 
      diff >= 0
        ? `Profit: ₹${diff}`
        : `Loss: ₹${Math.abs(diff)}`;
    document.getElementById("savings").style.color = diff >= 0 ? "green" : "red";

    renderTable("receiptTable", receipts);
    renderTable("paymentTable", payments);
    renderPieChart("incomeChart", incomePie, "Income");
    renderPieChart("expenseChart", expensePie, "Expense");
  }

  function renderTable(id, items) {
    const tbody = document.getElementById(id).querySelector("tbody");
    tbody.innerHTML = "";
    items.forEach(t => {
      const tr = document.createElement("tr");
      ["adate", "amount", "acat", "anote"].forEach(k => {
        const td = document.createElement("td");
        td.textContent = t[k];
        tr.appendChild(td);
      });
      tbody.appendChild(tr);
    });
  }

  let incomeChart, expenseChart;
  function renderPieChart(canvasId, dataMap, label) {
    const ctx = document.getElementById(canvasId).getContext("2d");
    const labels = Object.keys(dataMap);
    const data = Object.values(dataMap);

    const config = {
      type: "pie",
      data: {
        labels: labels,
        datasets: [{
          label,
          data: data,
          backgroundColor: colors.slice(0, labels.length),
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { position: 'bottom' }
        }
      }
    };

    if (canvasId === "incomeChart") {
      if (incomeChart) incomeChart.destroy();
      incomeChart = new Chart(ctx, config);
    } else {
      if (expenseChart) expenseChart.destroy();
      expenseChart = new Chart(ctx, config);
    }
  }
</script>


</body>
</html>
