
<html>
<head>
  
  <title>BRET</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/png" href="favicon.png">
  <script src="import/chart.js"></script>
  <script src="dialog/calendar.js"></script>
  <script src="dialog/dialog.js"></script>
 
  <link rel="Stylesheet" href="index_styles.css">
</head>
<body>
<div id="loading-screen">
  <div class="loader">
    <div></div><div></div><div></div>
    <div></div><div></div><div></div>
  </div>
</div>


  <div class="back"></div>
  <div class="over"></div>


<div class = "con">
  <h1>BReT</h1>
  
 <div class= "cflow">
	
	<a href="add.html">
	
	<div class="card tilt">
	<h3>
	Report transaction </h3> <br>
	<p>
	Report the transactions that has <br>taken place for future use.</p>
	</div>
	</a>
	<div class="card tilt" onclick="filterTransactions()">
	<h3>
	View Statement </h3> <br>
	<p>
	Visualize your monthly transactions <br> with organized statement.</p>
	</div>
	
 </div>
 <br>

<div class = "vis" id = "visible">
<div class="tcard" >
	<center>
	<h3 id="head"></h3>
	</center>
  </div>
<div class= "cflow">
  <div class="sumcard tilt" >
	<h4>Revenue</h4>
	<h3 id="prev"></h3>
  </div>
  <div class="sumcard tilt" >
	<h4>Expense</h4>
	<h3 id="pexp"></h3>
  </div>
  <div class="sumcard tilt" >
	<h4 id="lp"></h4>
	<h3 id="lpamt"></h3>
  </div>
 </div> 
<div class= "cflow">
  <div class="chart-container tilt">
    <h2>Receipts Classification</h2>
    <canvas id="incomeChart"></canvas>
  </div>

  <div class="chart-container tilt">
    <h2>Payments Classification</h2>
    <canvas id="expenseChart"></canvas>
  </div>
  </div>
<div class= "cflow">
  <div class="chartcbar tilt">
    <h2>Revenue v/s Expenses (Categorised) </h2>
    <canvas id="barChart" width = "1000px"></canvas>
	</div>
  </div>
  <br>
  <center>
 <div class="neon-btn" onclick="downloadReport()">Download statement as pdf</div>
 </center>
<br>
  <div class="receipt">
    <h1>All Receipt Transactions</h1>
    <table id="receiptTable">
      <thead>
        <tr><th>Date</th><th>Amount</th><th>Category</th><th>Notes</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
  
<hr>
  <div class="payment">
    <h1>All Payment Transactions</h1>
    <table id="paymentTable">
      <thead>
        <tr><th>Date</th><th>Amount</th><th>Category</th><th>Notes</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
 
  </div>
  </div>
  
<script src="import/jspdf.js"></script>
<script src="import/autotable.js"></script>
<script src="pdfdownload.js"></script>
 
<script>
window.addEventListener("load", () => {
  const loader = document.getElementById("loading-screen");
  const content = document.querySelector(".content");

  
  loader.style.opacity = "0";
 

  

  setTimeout(() => {
    loader.style.display = "none";
    
  }, 5100); 
});



const setv = document.getElementById("visible");
const months = [
    "January", "February", "March", "April", "May", "June",
    "July", "August", "September", "October", "November", "December"
  ];

  const colors = [
    "#00b894", "#0984e3", "#6c5ce7", "#d63031", "#fdcb6e",
          "#e17055", "#2d3436", "#fab1a0", "#55efc4", "#ffeaa7"
        
  ];
	const mlist = [ "Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];

  function filterTransactions() {
    selectMonthYear((m,y)=> {
	
	

    const dcode = parseInt(`${m+1}${y}`);
	
    const all = JSON.parse(localStorage.getItem("transactions") || "[]");
    const current = all.filter(t => t.acode === dcode);
	if(current.length!= 0)
	{

    let receipts = [], payments = [];
    let incomeTotal = 0, expenseTotal = 0;
    let incomePie = {}, expensePie = {};

    current.forEach(t => {
      if (t.atype) {
        receipts.push(t);
        incomeTotal += t.amount;
        incomePie[t.acat] = (incomePie[t.acat] || 0) + t.amount;
      } else {
        payments.push(t);
        expenseTotal += t.amount;
        expensePie[t.acat] = (expensePie[t.acat] || 0) + t.amount;
      }
    });

    document.getElementById("prev").innerText =
      `₹${formatIndianNumber(incomeTotal)}`;
	 document.getElementById("pexp").innerText =
      `₹${formatIndianNumber(expenseTotal)}`;
	 const mshort = mlist[m];
	document.getElementById("head").innerText =
      `Statement report of ${mshort}, ${y}`;


    const diff = incomeTotal - expenseTotal;
    document.getElementById("lp").innerText = 
      diff >= 0
        ? `Profit`
        : `Loss`;
	document.getElementById("lpamt").innerText = `₹${formatIndianNumber(Math.abs(diff))}`;
    document.getElementById("lpamt").style.color = diff >= 0 ? "green" : "red";
	setv.style.display = 'block';

    renderTable("receiptTable", receipts);
    renderTable("paymentTable", payments);
	renderBarChart("barChart", incomeTotal, expensePie);

    renderPieChart("incomeChart", incomePie, "Income");
    renderPieChart("expenseChart", expensePie, "Expense");
	}
	else
	{
		const errorSound = new Audio('sound/error.mp3'); 
			errorSound.play();
		alertCustom("The selected time period has no transactions!");
		
	}
	
	});
  }

  function renderTable(id, items) {
    const tbody = document.getElementById(id).querySelector("tbody");
    tbody.innerHTML = "";
    items.forEach(t => {
      const tr = document.createElement("tr");
      ["adate", "amount", "acat", "anote"].forEach(k => {
        const td = document.createElement("td");
        td.textContent = t[k];
        tr.appendChild(td);
      });
      tbody.appendChild(tr);
    });
  }

  let incomeChart, expenseChart;
  function renderPieChart(canvasId, dataMap, label) {
  const ctx = document.getElementById(canvasId).getContext("2d");
  const labels = Object.keys(dataMap);
  const data = Object.values(dataMap);

  const config = {
    type: "pie",
    data: {
      labels: labels,
      datasets: [{
        label,
        data: data,
        backgroundColor: colors,
        borderColor: "#121212",
        borderWidth: 2
      }]
    },
    options: {
      responsive: true,
      animation: {
        animateScale: true,
        animateRotate: true
      },
      plugins: {
        legend: {
          position: 'bottom',
          labels: {
            color: "#e0e0e0",
            font: { size: 14 }
          }
        },
        tooltip: {
          backgroundColor: "#1f1f1f",
          titleColor: "#00ff9d",
          bodyColor: "#ffffff",
          borderColor: "#333",
          borderWidth: 1
        }
      }
    }
  };

  if (canvasId === "incomeChart") {
    if (incomeChart) incomeChart.destroy();
    incomeChart = new Chart(ctx, config);
  } else {
    if (expenseChart) expenseChart.destroy();
    expenseChart = new Chart(ctx, config);
  }
}
let barChart;
function renderBarChart(canvasId, incomeTotal, expenseDataMap) {
  const ctx = document.getElementById(canvasId).getContext("2d");

  
 const sortedExpenses = Object.entries(expenseDataMap)
  .sort((a, b) => b[1] - a[1]);

const expenseLabels = sortedExpenses.map(item => item[0]);
const expenseValues = sortedExpenses.map(item => item[1]);

  const labels = ["Total Revenue", ...expenseLabels];
  const data = [incomeTotal, ...expenseValues];

  
  const revenueCanvas = document.createElement("canvas");
  const revenueCtx = revenueCanvas.getContext("2d");
  revenueCanvas.width = 20;
  revenueCanvas.height = 20;
  revenueCtx.fillStyle = "#00b894";
  revenueCtx.fillRect(0, 0, 20, 20);
  revenueCtx.strokeStyle = "#ffffff";
  revenueCtx.lineWidth = 4;
  revenueCtx.beginPath();
  revenueCtx.moveTo(0, 20);
  revenueCtx.lineTo(20, 0);
  revenueCtx.stroke();
  const stripedPattern = ctx.createPattern(revenueCanvas, "repeat");

  
  const expenseColors = expenseLabels.map((_, i) => colors[i % colors.length]);
  const backgroundColors = [stripedPattern, ...expenseColors];

  const config = {
    type: "bar",
    data: {
      labels: labels,
      datasets: [{
        label: "Amount",
        data: data,
        backgroundColor: backgroundColors,
        borderColor: "#121212",
        borderWidth: 2,
		barThickness: 33
      }]
    },
    options: {
      responsive: true,
      scales: {
        x: {
          ticks: { color: "#e0e0e0", font: { size: 14 } },
          grid: { color: "#444" }
        },
        y: {
          beginAtZero: true,
          ticks: { color: "#e0e0e0", font: { size: 14 } },
          grid: { color: "#444" }
        }
      },
      plugins: {
        legend: {
          labels: { color: "#e0e0e0", font: { size: 14 } }
        },
        tooltip: {
          backgroundColor: "#1f1f1f",
          titleColor: "#00ff9d",
          bodyColor: "#ffffff",
          borderColor: "#333",
          borderWidth: 1
        }
      }
    }
  };

  if (barChart) barChart.destroy();
  barChart = new Chart(ctx, config);
}



document.querySelectorAll('a[href^="#"], button').forEach(el => {
  el.addEventListener('click', e => {
    const targetId = el.getAttribute('href');
    if (targetId && targetId.startsWith("#")) {
      e.preventDefault();
      document.querySelector(targetId).scrollIntoView({ behavior: 'smooth' });
    }
  });
});


const faders = document.querySelectorAll('.summary, .chart-container, table, h2');

const appearOptions = { threshold: 0.1 };

const appearOnScroll = new IntersectionObserver((entries, observer) => {
  entries.forEach(entry => {
    if (!entry.isIntersecting) return;
    entry.target.classList.add('appear');
    observer.unobserve(entry.target);
  });
}, appearOptions);

faders.forEach(fader => {
  fader.classList.add('fade-start');
  appearOnScroll.observe(fader);
});


function formatIndianNumber(num) {
  if (num >= 10000000) {
    
    let val = (num / 10000000).toFixed(2);
    return removeTrailingZero(val) + " Cr";
  } else if (num >= 100000) {
    
    let val = (num / 100000).toFixed(2);
    return removeTrailingZero(val) + " L";
  } else {
    
    return num.toLocaleString('en-IN');
  }
}

function removeTrailingZero(val) {
  return val.replace(/\.00$/, ''); 
}
const cards = document.querySelectorAll('.tilt');
    cards.forEach(card => {
      card.addEventListener('mousemove', (e) => {
        const rect = card.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        const centerX = rect.width / 2;
        const centerY = rect.height / 2;
        const rotateX = (y - centerY) / 12;
        const rotateY = (x - centerX) / 13;
        card.style.transform = `rotateX(${-rotateX}deg) rotateY(${rotateY}deg) scale(1.05)`;
      });

      card.addEventListener('mouseleave', () => {
        card.style.transform = 'rotateX(0deg) rotateY(0deg) scale(1)';
      });
    });
 
</script>





<script>

document.addEventListener('mousemove', e => {
  const glow = document.createElement('div');
  glow.className = 'trail';
  glow.style.left = `${e.clientX}px`;
  glow.style.top = `${e.clientY}px`;
  document.body.appendChild(glow);

  setTimeout(() => glow.remove(), 150);
});


document.addEventListener('click', e => {
  const ripple = document.createElement('div');
  ripple.className = 'ripple';
  ripple.style.left = `${e.clientX}px`;
  ripple.style.top = `${e.clientY}px`;
  document.body.appendChild(ripple);

  setTimeout(() => ripple.remove(), 800);
});
</script>

</body>
</html>
