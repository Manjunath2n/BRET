
<html>
<head>
  
  <title>HOME</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="chart.js"></script>
 
  <link rel="Stylesheet" href="index_styles.css">
</head>
<body>
  <!-- Loading Screen -->
<div id="loading-screen">
  <div class="loader"></div>
  <p>Loading...</p>
</div>

<!-- Floating Theme Toggle -->
<button id="theme-toggle" title="Toggle Theme">ðŸŒ™</button>
<script src="theme.js"></script>




  <h1>BREt</h1>
  
<center>
	<a href="add.html"><button>Add transaction</button></a><br>
	<hr>
	<br>
  <div class="filter">
    <select id="month">
      <option value="">Select Month</option>
    </select>
    <select id="year">
      <option value="">Select Year</option>
    </select>
    <button onclick="filterTransactions()">View</button>
  </div>
  </center>
<hr>

<div class = "vis" id = "visible">
  <div class="summary" id="summary"></div>
  <div class="summary" id="savings"></div>
  

  <div class="chart-container">
    <h2>Receipts Classification</h2>
    <canvas id="incomeChart"></canvas>
  </div>

  <div class="chart-container">
    <h2>Payments Classification</h2>
    <canvas id="expenseChart"></canvas>
  </div>
<hr>
  <div class="receipt">
    <h2>All Receipt Transactions</h2>
    <table id="receiptTable">
      <thead>
        <tr><th>Date</th><th>Amount</th><th>Category</th><th>Notes</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
  
<hr>
  <div class="payment">
    <h2>All Payment Transactions</h2>
    <table id="paymentTable">
      <thead>
        <tr><th>Date</th><th>Amount</th><th>Category</th><th>Notes</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
  </div>
<script>
const setv = document.getElementById("visible");
const months = [
    "January", "February", "March", "April", "May", "June",
    "July", "August", "September", "October", "November", "December"
  ];

  const colors = [
    "rgb(128,0,0)", "rgb(0,128,0)", "rgb(0,0,140)", "rgb(128,125,0)",
    "rgb(128,0,128)", "rgb(0,125,128)", "rgb(153,153,255)",
    "rgb(255,130,128)", "rgb(255,255,255)", "rgb(51,51,153)",
    "rgb(66,154,124)"
  ];
	
  const currentYear = new Date().getFullYear();
  const monthSelect = document.getElementById("month");
  const yearSelect = document.getElementById("year");

  months.forEach((m, i) => {
    const opt = document.createElement("option");
    opt.value = i + 1;
    opt.text = m;
    monthSelect.add(opt);
  });

  for (let y = currentYear - 1; y <= currentYear + 3; y++) {
    const opt = document.createElement("option");
    opt.value = y;
    opt.text = y;
    yearSelect.add(opt);
  }

  function filterTransactions() {
    const m = parseInt(monthSelect.value);
    const y = parseInt(yearSelect.value);
    if (!m || !y) return alert("Select both month and year");

    const dcode = parseInt(`${m}${y}`);
    const all = JSON.parse(localStorage.getItem("transactions") || "[]");
    const current = all.filter(t => t.acode === dcode);

    let receipts = [], payments = [];
    let incomeTotal = 0, expenseTotal = 0;
    let incomePie = {}, expensePie = {};

    current.forEach(t => {
      if (t.atype) {
        receipts.push(t);
        incomeTotal += t.amount;
        incomePie[t.acat] = (incomePie[t.acat] || 0) + t.amount;
      } else {
        payments.push(t);
        expenseTotal += t.amount;
        expensePie[t.acat] = (expensePie[t.acat] || 0) + t.amount;
      }
    });

    document.getElementById("summary").innerText =
      `Total Revenue: â‚¹${incomeTotal}, Total Expense: â‚¹${expenseTotal}`;

    const diff = incomeTotal - expenseTotal;
    document.getElementById("savings").innerText = 
      diff >= 0
        ? `Profit: â‚¹${diff}`
        : `Loss: â‚¹${Math.abs(diff)}`;
    document.getElementById("savings").style.color = diff >= 0 ? "green" : "red";
	setv.style.display = 'block';

    renderTable("receiptTable", receipts);
    renderTable("paymentTable", payments);
    renderPieChart("incomeChart", incomePie, "Income");
    renderPieChart("expenseChart", expensePie, "Expense");
  }

  function renderTable(id, items) {
    const tbody = document.getElementById(id).querySelector("tbody");
    tbody.innerHTML = "";
    items.forEach(t => {
      const tr = document.createElement("tr");
      ["adate", "amount", "acat", "anote"].forEach(k => {
        const td = document.createElement("td");
        td.textContent = t[k];
        tr.appendChild(td);
      });
      tbody.appendChild(tr);
    });
  }

  let incomeChart, expenseChart;
  function renderPieChart(canvasId, dataMap, label) {
  const ctx = document.getElementById(canvasId).getContext("2d");
  const labels = Object.keys(dataMap);
  const data = Object.values(dataMap);

  const config = {
    type: "pie",
    data: {
      labels: labels,
      datasets: [{
        label,
        data: data,
        backgroundColor: [
          "#00b894", "#0984e3", "#6c5ce7", "#d63031", "#fdcb6e",
          "#e17055", "#2d3436", "#fab1a0", "#55efc4", "#ffeaa7"
        ],
        borderColor: "#121212",
        borderWidth: 2
      }]
    },
    options: {
      responsive: true,
      animation: {
        animateScale: true,
        animateRotate: true
      },
      plugins: {
        legend: {
          position: 'bottom',
          labels: {
            color: "#e0e0e0",
            font: { size: 14 }
          }
        },
        tooltip: {
          backgroundColor: "#1f1f1f",
          titleColor: "#00ff9d",
          bodyColor: "#ffffff",
          borderColor: "#333",
          borderWidth: 1
        }
      }
    }
  };

  if (canvasId === "incomeChart") {
    if (incomeChart) incomeChart.destroy();
    incomeChart = new Chart(ctx, config);
  } else {
    if (expenseChart) expenseChart.destroy();
    expenseChart = new Chart(ctx, config);
  }
}
// Smooth scroll animation for internal links
document.querySelectorAll('a[href^="#"], button').forEach(el => {
  el.addEventListener('click', e => {
    const targetId = el.getAttribute('href');
    if (targetId && targetId.startsWith("#")) {
      e.preventDefault();
      document.querySelector(targetId).scrollIntoView({ behavior: 'smooth' });
    }
  });
});

// Fade-in on scroll
const faders = document.querySelectorAll('.summary, .chart-container, table, h2');

const appearOptions = { threshold: 0.1 };

const appearOnScroll = new IntersectionObserver((entries, observer) => {
  entries.forEach(entry => {
    if (!entry.isIntersecting) return;
    entry.target.classList.add('appear');
    observer.unobserve(entry.target);
  });
}, appearOptions);

faders.forEach(fader => {
  fader.classList.add('fade-start');
  appearOnScroll.observe(fader);
});

// Loading screen fade-out
window.addEventListener("load", () => {
  setTimeout(() => {
    document.getElementById("loading-screen").classList.add("hidden");
  }, 4000); // 7 seconds
});

// Theme toggle setup
document.addEventListener("DOMContentLoaded", () => {
  const themeToggle = document.getElementById("theme-toggle");

  // Apply theme
  function applyTheme(theme) {
    if (theme === "light") {
      document.body.classList.add("light-theme");
      themeToggle.textContent = "ðŸŒž";
    } else {
      document.body.classList.remove("light-theme");
      themeToggle.textContent = "ðŸŒ™";
    }
    localStorage.setItem("theme", theme);
  }

  // Toggle button click
  themeToggle.addEventListener("click", () => {
    const current = localStorage.getItem("theme") || "dark";
    applyTheme(current === "dark" ? "light" : "dark");
  });

  // Apply saved theme immediately
  applyTheme(localStorage.getItem("theme") || "dark");
});


</script>


</body>
</html>
